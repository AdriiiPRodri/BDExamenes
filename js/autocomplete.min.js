function split(e){return e.split(/,\s*/)}function extractLast(e){return split(e).pop()}function mostrarResultados(e){for(var t="",n=split($(".search").val()),o=0;o<n.length;o++)t+="tag"+o+"="+encodeURI(n[o])+"&";t+="page="+e,$.getJSON("./php/getter.php",t,function(t,n){1==e&&$(".results").empty(),page_limit=Math.floor(t.num_r/20)+1,t.num_r>0?$.each(t,function(e,t){if("num_r"!=e&&null!=t){var n=encodeURI(t[0]+"/"+e);$(".results").append("<li><a href="+n+' target="_blank"><img class="image" src="img/'+t[1]+'.jpg"><br>'+e+"</a></li>")}}):$(".results").val("").append("<li><a>No se encontraron resultados</a></li>")})}function compressView(e){$(".container").css("marginTop","0").css("marginBottom",parseInt(e[1],10)/2),$(".header").css("font-size","0")}function decompressView(e){$(".container").css("marginTop",e[0]).css("marginBottom",e[1]),$(".header").css("font-size",e[2])}var pag=1,page_limit;$(document).ready(function(){var e=[$(".container").css("marginTop"),$(".container").css("marginBottom"),$(".header").css("font-size")];$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-50&&pag<page_limit&&mostrarResultados(++pag)}),$(".buttom_up").on("click",function(){$("html, body").animate({scrollTop:0})}),$(".icon").click(function(){mostrarResultados(1)}),$(".search").one("input",function(){compressView(e)}).on("click",function(){this.select()}).keydown(function(e){13==e.keyCode&&mostrarResultados(1)}).focusout(function(){decompressView(e),$(".search").one("input",function(){compressView(e)})}).autocomplete({autoFocus:!0,create:function(e,t){$(".search").val(""),$.getJSON("./php/tagger.php",function(e,t){cache=e;for(var n=5,o=0;o<n;o++){var s=document.createElement("li");s.innerHTML=e[o],s.onclick=function(){var e=split($(".search").val()),t=e.indexOf(this.innerHTML);t!=-1?e.splice(t,1):(""==e[e.length-1]&&e.pop(),e.push(this.innerHTML),e.push("")),$(".search").val(e.join(", ")),pag=1,mostrarResultados(1)},$(".suggestions").append(s)}})},source:function(e,t){var n=$.ui.autocomplete.escapeRegex(extractLast(e.term));n=n.replace(/[aá]/gi,"[aá]").replace(/[eé]/gi,"[eé]").replace(/[ií]/gi,"[ií]").replace(/[oó]/gi,"[oó]");var o=new RegExp("^"+n,"i");t($.grep(cache,function(e){return o.test(e)}))},select:function(e,t){pag=1;var n=split(this.value);return n.pop(),n.push(t.item.value),n.push(""),$(".search").val(n.join(", ")),mostrarResultados(pag),!1}})});