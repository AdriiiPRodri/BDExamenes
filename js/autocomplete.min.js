function split(t){return t.split(/,\s*/)}function extractLast(t){return split(t).pop()}function mostrarResultados(t){for(var e="",n=split($(".search").val()),o=0;o<n.length;o++)e+="tag"+o+"="+encodeURI(n[o])+"&";e+="page="+t,$.getJSON("./php/getter.php",e,function(e,n){1==t&&$(".results").empty(),page_limit=Math.floor(e.num_r/20)+1,e.num_r>0?$.each(e,function(t,e){if("num_r"!=t&&null!=e){var n=encodeURI(e[0]+"/"+t);$(".results").append("<li><a href="+n+' target="_blank"><img class="image" src="img/'+e[1]+'.jpg"><br>'+t+"</a></li>")}}):$(".results").val("").append("<li><a>No se encontraron resultados</a></li>")})}var pag=1,page_limit;$(document).ready(function(){var t=[$(".container").css("marginTop"),$(".container").css("marginBottom"),$(".header").css("font-size")];$(window).on("popstate",function(){var e=location.hash,n=e.split("#!/"),o=n[1];if(""!==o){var a=window.location.hash;""===a&&0===document.body.scrollTop&&($(".container").css("marginTop",t[0]).css("marginBottom",t[1]),$(".header").css("font-size",t[2]))}}).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-50&&pag<page_limit&&mostrarResultados(++pag)}),$(".buttom_up").on("click",function(){$("html, body").animate({scrollTop:0})}),$(".icon").click(function(){mostrarResultados(1)}),$(".search").one("input",function(){window.history.pushState("forward",null,"#forward"),$(".container").css("marginTop","0").css("marginBottom",parseInt(t[1],10)/2),$(".header").css("font-size","0")}).on("click",function(){this.select()}).keydown(function(t){13==t.keyCode&&mostrarResultados(1)}).focusout(function(){$(".container").css("marginTop",t[0]).css("marginBottom",t[1]),$(".header").css("font-size",t[2]),$(".search").one("input",function(){window.history.pushState("forward",null,"#forward"),$(".container").css("marginTop","0").css("marginBottom",parseInt(t[1],10)/2),$(".header").css("font-size","0")})}).autocomplete({autoFocus:!0,create:function(t,e){$(".search").val(""),$.getJSON("./php/tagger.php",function(t,e){cache=t;for(var n=5,o=0;o<n;o++){var a=document.createElement("li");a.innerHTML=t[o],a.onclick=function(){var t=split($(".search").val()),e=t.indexOf(this.innerHTML);e!=-1?t.splice(e,1):(""==t[t.length-1]&&t.pop(),t.push(this.innerHTML),t.push("")),$(".search").val(t.join(", ")),pag=1,mostrarResultados(1)},$(".suggestions").append(a)}})},source:function(t,e){var n=$.ui.autocomplete.escapeRegex(extractLast(t.term));n=n.replace(/[aá]/gi,"[aá]").replace(/[eé]/gi,"[eé]"),n=n.replace(/[ií]/gi,"[ií]").replace(/[oó]/gi,"[oó]");var o=new RegExp("^"+n,"i");e($.grep(cache,function(t){return o.test(t)}))},select:function(t,e){pag=1;var n=split(this.value);return n.pop(),n.push(e.item.value),n.push(""),$(".search").val(n.join(", ")),mostrarResultados(pag),!1}})});