function newOption(e){var n=document.createElement("option");return n.text=e,n}function uploadFile(e){var n="php/uploader.php",t=new XMLHttpRequest;t.open("POST",n,!0),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&genThumbnail(e,JSON.parse(t.responseText))};var a=new FormData;a.append("file",e),t.send(a)}function showToast(e){var n=document.getElementById("snackbar");n.innerHTML=e,n.className="show",setTimeout(function(){n.className=n.className.replace("show","")},3e3)}function genThumbnail(e,n){var t=document.querySelector(".gallery"),a=document.createElement("div");if(a.classList.add("thumbnail"),n.duplicate)showToast("El archivo ya se encuentra en la base de datos");else{var i=document.createElement("img");i.src="img/default.jpg",i.classList.add("imgprop");var d=document.createElement("div");d.classList.add("div-image"),d.appendChild(i),d.innerHTML=d.innerHTML+"<br>"+e.name,a.appendChild(d);var l=document.createElement("div");l.classList.add("div-select");var r=document.createElement("div");r.classList.add("div-buttons");var o=document.createElement("span");o.innerHTML="Asignatura: ";var c=document.createElement("select");for(var s in n.asig)c.add(newOption(n.asig[s]));o.appendChild(c),l.appendChild(o);var p=document.createElement("span");p.innerHTML="Año académico: ";var u=document.createElement("select");for(var s in n.anio)u.add(newOption(n.anio[s]));p.appendChild(u),l.appendChild(p),a.appendChild(l);var m=document.createElement("button");m.innerHTML="Subir",m.id=e.name,m.addEventListener("click",function(){var e=this.parentElement.parentElement,n=e.children[1],t=n.children[0].children[0].value,a=n.children[1].children[0].value,i=encodeURI("php/classifier.php?asig="+t+"&anio="+a+"&file="+this.id),d=new XMLHttpRequest;d.open("GET",i,!0),d.send(),showToast("El archivo se ha añadido con éxito"),this.parentElement.parentElement.style.display="none"}),r.appendChild(m);var h=document.createElement("button");h.innerHTML="Eliminar",h.addEventListener("click",function(){this.parentElement.parentElement.style.display="none"}),r.appendChild(h),a.appendChild(r),t.appendChild(a)}}document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("#fileinput");e.addEventListener("change",function(){document.querySelector(".loading").style.display="block","Aquí se previsualizarán los archivos"==document.querySelector(".gallery").innerHTML&&(document.querySelector(".gallery").innerHTML="");for(var e=0;e<this.files.length;e++)uploadFile(this.files[e]);document.querySelector(".loading").style.display="none"},!1)});