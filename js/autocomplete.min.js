function split(e){return e.split(/,\s*/)}function extractLast(e){return split(e).pop()}function mostrarResultados(e){for(var s="",t=split($(".search").val()),n=0;n<t.length;n++)s+="tag"+n+"="+encodeURI(t[n])+"&";s+="page="+e,$.getJSON("./php/getter.php",s,function(s,t){1==e&&$(".results").empty(),page_limit=Math.floor(s.num_r/20)+1,s.num_r>0?$.each(s,function(e,s){if("num_r"!=e&&null!=s){var t=encodeURI(s[0]+"/"+e);$(".results").append("<li><a href="+t+' target="_blank"><img class="image" src="img/'+s[1]+'.jpg"><br>'+e+"</a></li>")}}):($(".results").val(""),$(".results").append("<li><a>No se encontraron resultados</a></li>"))})}var pag=1,page_limit;$(document).ready(function(){var e=[$(".container").css("marginTop"),$(".container").css("marginBottom"),$(".header").css("font-size"),$(".hline_text").css("font-size"),$(".suggestions").css("display")];$(".search").on("focus",function(){$(".container").css("marginTop","0"),$(".container").css("marginBottom","0"),$(".header").css("font-size","0"),$(".hline_text").css("font-size","0"),$(".suggestions").css("display","none"),this.select()});var s=0;$(window).scroll(function(){var t=window.pageYOffset||document.documentElement.scrollTop;t<=s&&0===document.body.scrollTop&&($(".container").css("marginTop",e[0]),$(".container").css("marginBottom",e[1]),$(".header").css("font-size","40px"),$(".hline_text").css("font-size",e[3]),$(".suggestions").css("display",e[4])),s=t}),$(".results").append("<li><a>Los resultados se mostrarán aquí</a></li>"),$(".search").keydown(function(e){13==e.keyCode&&mostrarResultados(1)}),$(".icon").click(function(){mostrarResultados(1)}),$(".search").autocomplete({autoFocus:!0,create:function(e,s){$(".search").val(""),$.getJSON("./php/tagger.php",function(e,s){cache=e;for(var t=5,n=0;n<t;n++){var o=document.createElement("li");o.innerHTML=e[n],o.onclick=function(){var e=split($(".search").val()),s=e.indexOf(this.innerHTML);s!=-1?e.splice(s,1):(""==e[e.length-1]&&e.pop(),e.push(this.innerHTML),e.push("")),$(".search").val(e.join(", ")),pag=1,mostrarResultados(1)},$(".suggestions").append(o)}})},source:function(e,s){var t=$.ui.autocomplete.escapeRegex(extractLast(e.term));t=t.replace(/[aá]/gi,"[aá]").replace(/[eé]/gi,"[eé]"),t=t.replace(/[ií]/gi,"[ií]").replace(/[oó]/gi,"[oó]");var n=new RegExp("^"+t,"i");s($.grep(cache,function(e){return n.test(e)}))},select:function(e,s){pag=1;var t=split(this.value);return t.pop(),t.push(s.item.value),t.push(""),$(".search").val(t.join(", ")),mostrarResultados(pag),!1}}),$(".buttom_up").on("click",function(){$("html, body").animate({scrollTop:0},"slow")}),$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-50&&pag<page_limit&&mostrarResultados(++pag)})});