function split(t){return t.split(/,\s*/)}function extractLast(t){return split(t).pop()}function mostrarResultados(t){for(var a="",e=split($(".search-input").val()),n=0;n<e.length;n++)a+="tag"+n+"="+encodeURI(e[n])+"&";a+="page="+t,$.getJSON("./php/getter.php",a,function(a,e){1==t&&$("#lista").empty(),page_limit=Math.floor(a.num_r/20)+1,a.num_r>0?$.each(a,function(t,a){if("num_r"!=t&&null!=a){var e=encodeURI(a[0]+"/"+t);$("#lista").append("<li><a href="+e+' target="_blank"><img class="image" src="./img/'+a[1]+'.png"><div class="imagetext">'+t+"</div></a></li>")}}):($("#lista").empty(),$("#lista").append("<li><a>No se encontraron resultados</a></li>"))})}var pag=1,page_limit;$(document).ready(function(){$("button#up").hide(),$("#lista").append("<li><a>Los resultados se mostrarán aquí</a></li>"),$(".search-input").autocomplete({autoFocus:!0,create:function(t,a){$(".search-input").val(""),$.getJSON("./php/tagger.php",function(t,a){cache=t;for(var e=5,n=0;n<e;n++){var i=document.createElement("li");i.innerHTML=t[n],i.onclick=function(){var t=split($(".search-input").val());""==t[t.length-1]&&t.pop(),t.push(this.innerHTML),t.push(""),$(".search-input").val(t.join(", ")),mostrarResultados(pag)},$("#suglist").append(i)}})},source:function(t,a){var e=$.ui.autocomplete.escapeRegex(extractLast(t.term));e=e.replace(/[aá]/gi,"[aá]").replace(/[eé]/gi,"[eé]"),e=e.replace(/[ií]/gi,"[ií]").replace(/[oó]/gi,"[oó]");var n=new RegExp("^"+e,"i");a($.grep(cache,function(t){return n.test(t)}))},search:function(){var t=extractLast(this.value);if(t.length<2)return!1},change:function(){pag=1,mostrarResultados(pag)},select:function(t,a){pag=1;var e=split(this.value);return e.pop(),e.push(a.item.value),e.push(""),$(".search-input").val(e.join(", ")),mostrarResultados(pag),!1}}),$("button#up").on("click",function(){$("html, body").animate({scrollTop:0},"fast")}),$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-50&&pag<page_limit&&($("button#up").show(),mostrarResultados(++pag))})});