function newOption(e){var n=document.createElement("option");return n.text=e,n}function uploadFile(e){var n="php/uploader.php",t=new XMLHttpRequest;t.open("POST",n,!0),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&genThumbnail(e,JSON.parse(t.responseText))};var a=new FormData;a.append("file",e),t.send(a)}function genThumbnail(e,n){var t=document.querySelector(".gallery"),a=document.createElement("div");if(a.classList.add("thumbnail"),console.log(n.duplicate),n.duplicate){a.innerHTML=a.innerHTML+e.name+" ya se encuentra clasificado en la base de datos<br>";var i=document.createElement("button");i.innerHTML="Eliminar",i.addEventListener("click",function(){this.parentElement.parentElement.style.display="none"}),a.appendChild(i)}else{var d=document.createElement("img");d.src="img/default.jpg",d.classList.add("imgprop");var r=document.createElement("div");r.classList.add("div-image"),r.appendChild(d),r.innerHTML=r.innerHTML+"<br>"+e.name,a.appendChild(r);var l=document.createElement("div");l.classList.add("div-select");var c=document.createElement("div");c.classList.add("div-buttons");var o=document.createElement("span");o.innerHTML="Asignatura: ";var s=document.createElement("select");for(var p in n.asig)s.add(newOption(n.asig[p]));o.appendChild(s),l.appendChild(o);var u=document.createElement("span");u.innerHTML="Año académico: ";var m=document.createElement("select");for(var p in n.anio)m.add(newOption(n.anio[p].toString()+(+n.anio[p]+1).toString()));u.appendChild(m),l.appendChild(u),a.appendChild(l);var v=document.createElement("button");v.innerHTML="Subir",v.id=e.name,v.addEventListener("click",function(){var e=this.parentElement.parentElement,n=e.children[1],t=encodeURI(n.children[0].children[0].value),a=encodeURI(n.children[1].children[0].value),i="php/classifier.php?asig="+t+"&anio="+a+"&file="+encodeURI(this.id),d=new XMLHttpRequest;d.open("GET",i,!0),d.send(),this.parentElement.parentElement.style.display="none"}),c.appendChild(v);var i=document.createElement("button");i.innerHTML="Eliminar",i.addEventListener("click",function(){this.parentElement.parentElement.style.display="none"}),c.appendChild(i),a.appendChild(c)}t.appendChild(a)}document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("#fileinput");e.addEventListener("change",function(){"Aquí se previsualizarán los archivos"==document.querySelector(".gallery").innerHTML&&(document.querySelector(".gallery").innerHTML="");for(var e=0;e<this.files.length;e++)uploadFile(this.files[e])},!1)});