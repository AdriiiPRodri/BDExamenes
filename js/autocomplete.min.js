function split(e){return e.split(/,\s*/)}function extractLast(e){return split(e).pop()}function mostrarResultados(e){for(var t="",s=split($(".search").val()),a=0;a<s.length;a++)t+="tag"+a+"="+encodeURI(s[a])+"&";t+="page="+e,$.getJSON("./php/getter.php",t,function(t,s){1==e&&$(".results").empty(),page_limit=Math.floor(t.num_r/20)+1,t.num_r>0?$.each(t,function(e,t){if("num_r"!=e&&null!=t){var s=encodeURI(t[0]+"/"+e);$(".results").append("<li><a href="+s+' target="_blank"><img class="image" src="./img/'+t[1]+'.jpg"><br>'+e+"</a></li>")}}):($(".results").val(""),$(".results").append("<li><a>No se encontraron resultados</a></li>"))})}var pag=1,page_limit;$(document).ready(function(){$(".search").on("focus",function(){$(".search").css("margin-top","0"),$(".search").css("margin-bottom","1%"),$(".header").css("font-size","0"),$(".header").css("height","0"),$(".logo").css("height","0"),this.select()});var e=[$(".search").css("margin-top"),$(".search").css("margin-bottom"),$(".header").css("font-size"),$(".header").css("height"),$(".logo").css("height")],t=0;$(window).scroll(function(){var s=window.pageYOffset||document.documentElement.scrollTop;s<=t&&0===document.body.scrollTop&&($(".search").css("margin-top",e[0]),$(".search").css("margin-bottom",e[1]),$(".header").css("font-size",e[2]),$(".header").css("height",e[3]),$(".logo").css("height",e[4])),t=s}),$(".button_up").hide(),$(".results").append("<li><a>Los resultados se mostrarán aquí</a></li>"),$(".clearable").clearSearch(),$(".search").autocomplete({autoFocus:!0,create:function(e,t){$(".search").val(""),$.getJSON("./php/tagger.php",function(e,t){cache=e;for(var s=5,a=0;a<s;a++){var o=document.createElement("li");o.innerHTML=e[a],o.onclick=function(){var e=split($(".search").val()),t=e.indexOf(this.innerHTML);t!=-1?e.splice(t,1):(""==e[e.length-1]&&e.pop(),e.push(this.innerHTML),e.push("")),$(".search").val(e.join(", ")),mostrarResultados(pag)},$(".suggestions").append(o)}})},source:function(e,t){var s=$.ui.autocomplete.escapeRegex(extractLast(e.term));s=s.replace(/[aá]/gi,"[aá]").replace(/[eé]/gi,"[eé]"),s=s.replace(/[ií]/gi,"[ií]").replace(/[oó]/gi,"[oó]");var a=new RegExp("^"+s,"i");t($.grep(cache,function(e){return a.test(e)}))},search:function(){var e=extractLast(this.value);if(e.length<2)return!1},change:function(){pag=1,mostrarResultados(pag)},select:function(e,t){pag=1;var s=split(this.value);return s.pop(),s.push(t.item.value),s.push(""),$(".search").val(s.join(", ")),mostrarResultados(pag),!1}}),$(".buttom_up").on("click",function(){$("html, body").animate({scrollTop:0},"slow")}),$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-50&&pag<page_limit&&($(".buttom_up").show(),mostrarResultados(++pag))})});