function split(t){return t.split(/,\s*/)}function extractLast(t){return split(t).pop()}function mostrarResultados(t){for(var e="",a=split($(".search-input").val()),n=0;n<a.length;n++)e+="tag"+n+"="+encodeURI(a[n])+"&";e+="page="+t,$.getJSON("./php/getter.php",e,function(e,a){"success"==a&&(1==t&&$("#lista").empty(),page_limit=Math.floor(e.num_r/20)+1,e.num_r>0?$.each(e,function(t,e){if("num_r"!=t&&null!=e){var a=encodeURI(e+"/"+t);$("#lista").append("<li><a href="+a+' target="_blank">'+t+"</a></li>")}}):($("#lista").empty(),$("#lista").append("<li><a>No se encontraron resultados</a></li>")))})}var pag=1,page_limit;$(document).ready(function(){$("button#up").hide(),$("#lista").append("<li><a>Los resultados se mostrarán aquí</a></li>"),$(".search-input").autocomplete({autoFocus:!0,create:function(t,e){$(".search-input").val(""),$.getJSON("./php/tagger.php",function(t,e){cache=t;for(var a=20,n=0,i=0;n<a;i++)if(t[i].length>1){n+=t[i].length;var o=document.createElement("li");o.innerHTML=t[i],o.onclick=function(){var t=split($(".search-input").val());""==t[t.length-1]&&t.pop(),t.push(this.innerHTML),t.push(""),$(".search-input").val(t.join(", ")),mostrarResultados(pag)},$("#suglist").append(o)}else a++})},source:function(t,e){var a=$.ui.autocomplete.escapeRegex(extractLast(t.term));a=a.replace(/[aá]/gi,"[aá]").replace(/[eé]/gi,"[eé]"),a=a.replace(/[ií]/gi,"[ií]").replace(/[oó]/gi,"[oó]");var n=new RegExp("^"+a,"i");e($.grep(cache,function(t){return n.test(t)}))},search:function(){var t=extractLast(this.value);if(t.length<2)return!1},change:function(){pag=1,mostrarResultados(pag)},select:function(t,e){pag=1;var a=split(this.value);return a.pop(),a.push(e.item.value),a.push(""),$(".search-input").val(a.join(", ")),mostrarResultados(pag),!1}}),$("button#up").on("click",function(){$("html, body").animate({scrollTop:0},"fast")}),$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-50&&pag<page_limit&&($("button#up").show(),mostrarResultados(++pag))})});